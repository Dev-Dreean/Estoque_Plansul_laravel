# Codex Project Rules (Laravel Plansul)

## Fonte de Verdade
- Siga SEMPRE os contratos e padrões descritos em: `docs/PADROES_REAIS_SISTEMA.txt`
- Este arquivo (`.codex.md`) é o resumo executivo (regras curtas). Em conflito, o doc de padrões vence.

## Objetivo
Entregar features rápido SEMPRE reutilizando o que já existe.
NUNCA reinventar layout, JS, arquitetura, ou componentes.

## Stack (obrigatório)
- Laravel + Blade + Tailwind + Alpine
- Sem CSS customizado (sem <style>, sem classes próprias). Só Tailwind.
- Dark mode obrigatório: toda cor deve ter `dark:*`.
- JS: Alpine inline + `fetch()` (sem axios, sem jQuery, sem Vue/React).

## Regra #1: Reuso antes de criar
Antes de criar qualquer coisa nova, procurar e reaproveitar:
1) `resources/views/**` (telas e partials)
2) `resources/views/components/**` (componentes Blade)
3) `public/js/**` e padrões Alpine existentes
4) `app/Services/**` e `app/Http/Requests/**`

Se precisar “algo novo”:
- Preferir estender o existente (via @props, partials, métodos)
- Só criar novo se não existir equivalente (e explicar o porquê em 1 linha)

## Arquitetura (obrigatória)
- Controller: HTTP apenas (authorize, validar via FormRequest, chamar Service, retornar view/redirect/json).
- Service: regra de negócio + transação + logs + try/catch.
- Model: relacionamentos/scopes (sem regra de negócio no Blade e sem query no Controller).

## Autorização (sem exceção)
- Rotas usam middleware `tela.access:{NUSEQTELA}`.
- TODO método do controller que mexe em Model deve chamar `$this->authorize(...)`.
- Falha de permissão = 403 (não pode virar 500).

## Modal vs Página (contrato)
- Create/Edit padrão: PÁGINA.
- Modal em create/edit só com `?modal=1` (opt-in).
- Modal é para ações secundárias (confirm delete, preview, mini-form, bulk).

## Filtro (contrato)
- Fonte única de verdade = Query String (GET).
- Paginação deve manter query: `->withQueryString()`.
- Inputs devem manter state com `request('param')`.
- Nunca usar localStorage/session/cookies para filtro.

## JSON (contrato)
Toda resposta JSON deve seguir o shape padrão:
- `success` (bool)
- `message` (string)
- `data` (obj ou null)
- `errors` (somente validação)
HTTP: 200 ok, 422 validação, 403 permissão, 500 erro.

## Logs + Erros (obrigatório)
- Logs com emoji + contexto (user/id/acao).
- `try/catch` em operações críticas (especialmente delete/bulk/import/export).
- `fetch()` sempre com tratamento de erro e status.

## Saída desejada do Codex
Quando eu pedir uma feature:
- Dizer quais arquivos serão alterados/criados.
- Gerar apenas o necessário (evitar “refatoração criativa”).
- Reutilizar componentes/partials existentes.
- Garantir checklist: authorize + FormRequest + Tailwind dark + fetch com CSRF + logs.

## Idioma e Padronização (obrigatório)
- Toda interface visual (telas, modais, botões, labels, toasts e mensagens) deve estar em **Português do Brasil (pt-BR)**, com acentuação correta.
- Toda saída de relatório exportável (Excel/CSV/PDF/ODS) deve usar cabeçalhos e textos em pt-BR formal, sem caracteres corrompidos.
- Ao editar qualquer tela, revisar e corrigir imediatamente textos quebrados (ex.: `Ã§`, `Ã£`, `N?`, `Descri??o`, etc.).
- Esta regra é **bloqueante**: nenhuma entrega pode ser finalizada com texto fora do pt-BR correto ou com falhas de encoding.
