â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘            ğŸ“Š FLUXO COMPLETO - DO EMAIL Ã€ SOLICITAÃ‡ÃƒO                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”„ COMO TUDO FUNCIONA JUNTO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1ï¸âƒ£ USUÃRIO ENVIA EMAIL
   â”œâ”€ De: joao.silva@empresa.com.br
   â”œâ”€ Para: suporte.dev@plansul.com.br
   â”œâ”€ Assunto: Solicitacao de Bem
   â””â”€ Corpo:
      Nome: JoÃ£o Silva
      MatrÃ­cula: 12345
      Projeto: CASAN
      Estado: SC
      Setor: TI
      Entregar em: Almoxarifado
      
      2x Monitor 24"
      3x Teclado USB
      5x Mouse sem fio; UN; 100g

2ï¸âƒ£ POWER AUTOMATE DETECTA EMAIL
   â”œâ”€ Trigger dispara (novo email recebido)
   â”œâ”€ Extrai: from, subject, body
   â””â”€ Monta JSON com 3 campos

3ï¸âƒ£ POWER AUTOMATE ENVIA PARA API
   â”œâ”€ POST https://plansul.info/api/solicitacoes/email
   â”œâ”€ Headers:
   â”‚  â”œâ”€ Content-Type: application/json
   â”‚  â””â”€ X-API-KEY: 3a7f9e2c5b8d1a4f7c9e2b5a...
   â””â”€ Body JSON:
      {
        "from": "joao.silva@empresa.com.br",
        "subject": "Solicitacao de Bem",
        "body": "Nome: JoÃ£o Silva\nMatrÃ­cula..."
      }

4ï¸âƒ£ SERVIDOR LARAVEL RECEBE
   â”œâ”€ Valida token X-API-KEY
   â”œâ”€ Faz parsing do body:
   â”‚  â”œâ”€ Extrai "Nome:" â†’ solicitante_nome
   â”‚  â”œâ”€ Extrai "MatrÃ­cula:" â†’ solicitante_matricula
   â”‚  â”œâ”€ Extrai "Projeto:" â†’ busca projeto_id
   â”‚  â”œâ”€ Extrai "Estado:" â†’ uf
   â”‚  â”œâ”€ Extrai "Setor:" â†’ setor
   â”‚  â”œâ”€ Extrai "Entregar em:" â†’ local_destino
   â”‚  â””â”€ Extrai itens com Qtd, Unidade, Peso
   â””â”€ Valida dados obrigatÃ³rios

5ï¸âƒ£ SERVIDOR CRIA SOLICITAÃ‡ÃƒO
   â”œâ”€ Insere em banco de dados
   â”œâ”€ Cria items (Monitor, Teclado, Mouse)
   â”œâ”€ Gera ID da solicitaÃ§Ã£o
   â””â”€ Envia email de confirmaÃ§Ã£o ao usuÃ¡rio

6ï¸âƒ£ SERVIDOR RETORNA RESPOSTA
   â”œâ”€ Status: 200 OK
   â””â”€ Body:
      {
        "success": true,
        "message": "Solicitacao registrada com sucesso.",
        "solicitacao_id": 456
      }

7ï¸âƒ£ POWER AUTOMATE RECEBE RESPOSTA
   â”œâ”€ Verifica status 200
   â”œâ”€ Se sucesso: envia email de confirmaÃ§Ã£o
   â””â”€ Se erro: envia email com detalhes

8ï¸âƒ£ SOLICITAÃ‡ÃƒO APARECE NO DASHBOARD
   â”œâ”€ https://plansul.info/solicitacoes
   â”œâ”€ Status: Pendente
   â”œâ”€ Com todos os itens, quantidades, pesos
   â””â”€ Pronta para ser processada

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ DADOS CAPTURADOS DE CADA ITEM:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Email contÃ©m:
"2x Monitor 24"; 3; UN; 500g; Para sala 204"

Sistema extrai:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ descricao: "Monitor 24"          â”‚
â”‚ quantidade: 2                    â”‚
â”‚ unidade: "UN"                    â”‚
â”‚ peso: "500g"                     â”‚
â”‚ observacao: "Para sala 204"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Armazena no banco:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ solicitacao_bens_itens                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: 1                                   â”‚
â”‚ solicitacao_id: 456                     â”‚
â”‚ descricao: Monitor 24"                  â”‚
â”‚ quantidade: 2                           â”‚
â”‚ unidade: UN                             â”‚
â”‚ peso: 500g                              â”‚
â”‚ observacao: Para sala 204               â”‚
â”‚ created_at: 2026-01-26 18:30:00        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… O SISTEMA VALIDA AUTOMATICAMENTE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Antes de criar solicitaÃ§Ã£o, verifica:

âœ… Nome do solicitante (obrigatÃ³rio)
   â””â”€ Se nÃ£o achar em "Nome:", tenta "Solicitante:", "Solicitado por:", etc

âœ… Projeto (obrigatÃ³rio)
   â””â”€ Busca inteligente:
      1. Por cÃ³digo exato (281, 2, etc)
      2. Por nome completo (CASAN, BRADESCO)
      3. Por nome parcial (CASA encontra CASAN)
      4. Por semelhanÃ§a (CEF encontra CEF - RS)

âœ… Local de entrega (obrigatÃ³rio)
   â””â”€ Aceita qualquer descriÃ§Ã£o:
      - "Almoxarifado"
      - "Sala 204"
      - "RecepÃ§Ã£o do 2Âº andar"

âœ… Pelo menos 1 item (obrigatÃ³rio)
   â””â”€ Com descriÃ§Ã£o + quantidade

âœ… Opcionais:
   â”œâ”€ MatrÃ­cula do solicitante
   â”œâ”€ UF/Estado
   â”œâ”€ Setor
   â”œâ”€ ObservaÃ§Ãµes
   â”œâ”€ Peso dos itens
   â””â”€ Unidade dos itens (padrÃ£o: UN)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ SE FALTAR ALGO (Status 422):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Exemplo: Falta o "Projeto"

Email:
```
Nome: JoÃ£o
MatrÃ­cula: 123
Estado: SC
Setor: TI
Entregar em: Almoxarifado

2x Monitor
```

Resposta (erro):
```json
{
  "success": false,
  "message": "Missing required fields.",
  "missing": ["projeto_id"],
  "details": {
    "projeto_tentado": null,
    "hint": "Use um cÃ³digo de projeto vÃ¡lido (ex: 281, 2, 47)"
  }
}
```

ğŸ”§ SoluÃ§Ã£o: Adicionar no email:
```
Projeto: CASAN
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’» EXEMPLO REAL - TROCA JSON:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

USUÃRIO DIGITA NO EMAIL:
```
Nome: Maria Santos
MatrÃ­cula: 54321
Projeto: BRADESCO
Estado: RS
Setor: Financeiro
Entregar em: RecepÃ§Ã£o 2Âº andar
Detalhes: Entregar atÃ© sexta

3x Calculadora cientÃ­fica
10x Caneta azul; UN; 5g
2x RESMA papel A4; 75g
```

POWER AUTOMATE ENVIA:
```json
{
  "from": "maria.santos@empresa.com.br",
  "subject": "Solicitacao de Bem",
  "body": "Nome: Maria Santos\nMatrÃ­cula: 54321\nProjeto: BRADESCO\nEstado: RS\nSetor: Financeiro\nEntregar em: RecepÃ§Ã£o 2Âº andar\nDetalhes: Entregar atÃ© sexta\n\n3x Calculadora cientÃ­fica\n10x Caneta azul; UN; 5g\n2x RESMA papel A4; 75g"
}
```

LARAVEL PROCESSA E RETORNA:
```json
{
  "success": true,
  "message": "Solicitacao registrada com sucesso.",
  "solicitacao_id": 789
}
```

BANCO DE DADOS FICA:
```
solicitacoes_bens:
â”œâ”€ id: 789
â”œâ”€ solicitante_nome: Maria Santos
â”œâ”€ solicitante_matricula: 54321
â”œâ”€ email_origem: maria.santos@empresa.com.br
â”œâ”€ email_assunto: Solicitacao de Bem
â”œâ”€ projeto_id: 281
â”œâ”€ uf: RS
â”œâ”€ setor: Financeiro
â”œâ”€ local_destino: RecepÃ§Ã£o 2Âº andar
â”œâ”€ observacao: Entregar atÃ© sexta
â””â”€ status: pendente

solicitacoes_bens_itens:
â”œâ”€ Item 1: Calculadora cientÃ­fica | Qtd: 3 | UN: UN | Peso: -
â”œâ”€ Item 2: Caneta azul | Qtd: 10 | UN: UN | Peso: 5g
â””â”€ Item 3: Papel A4 | Qtd: 2 | UN: RESMA | Peso: 75g
```

DASHBOARD MOSTRA:
```
ğŸ¯ SolicitaÃ§Ã£o #789
â”œâ”€ Solicitante: Maria Santos
â”œâ”€ MatrÃ­cula: 54321
â”œâ”€ Projeto: BRADESCO
â”œâ”€ Estado: RS
â”œâ”€ Setor: Financeiro
â”œâ”€ Local: RecepÃ§Ã£o 2Âº andar
â”œâ”€ Status: Pendente
â””â”€ Itens:
   â”œâ”€ 3x Calculadora cientÃ­fica
   â”œâ”€ 10x Caneta azul (5g cada)
   â””â”€ 2x RESMA Papel A4 (75g)
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ TESTE RÃPIDO - COMO VERIFICAR:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. No Power Automate:
   â””â”€ Meus fluxos â†’ seu flow â†’ Ãºltima execuÃ§Ã£o
      â†’ Expanda a aÃ§Ã£o HTTP
         â†’ Inputs: mostra o JSON enviado
         â†’ Outputs: mostra a resposta (200 ou 422)

2. No Dashboard Plansul:
   â””â”€ https://plansul.info/solicitacoes
      â†’ Deve aparecer uma solicitaÃ§Ã£o nova

3. Nos Logs (SSH):
   â””â”€ ssh plansul@ftp.plansul.info
      tail -50 ~/www/estoque-laravel/storage/logs/laravel.log
      â””â”€ Procure por "POWER_AUTOMATE_EMAIL"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš¡ PERFORMANCE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Tempo total de processamento:
â”œâ”€ Email Ã© recebido â†’ 0 segundos
â”œâ”€ Power Automate detecta â†’ ~5 segundos (dependendo da configuraÃ§Ã£o)
â”œâ”€ Power Automate envia â†’ ~1 segundo
â”œâ”€ Laravel processa â†’ ~500ms
â”œâ”€ Email de confirmaÃ§Ã£o Ã© enviado â†’ ~2 segundos
â””â”€ TOTAL: 8-10 segundos aproximadamente

SolicitaÃ§Ã£o aparece no dashboard:
â””â”€ Imediatamente apÃ³s resposta 200

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ”’ SEGURANÃ‡A:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ… VerificaÃ§Ãµes de seguranÃ§a:
  â”œâ”€ Token X-API-KEY validado em cada request
  â”œâ”€ HTTPS/SSL (conexÃ£o encriptada)
  â”œâ”€ Dados sanitizados (SQL injection prevention)
  â”œâ”€ Rate limiting (mÃ¡ximo X requisiÃ§Ãµes/hora)
  â”œâ”€ Logs de auditoria (quem enviou, quando, quÃª)
  â””â”€ ValidaÃ§Ã£o de CORS (apenas domÃ­nios permitidos)

âš ï¸ Token API:
  â”œâ”€ Nunca compartilhe publicamente
  â”œâ”€ Use apenas em Power Automate privado
  â”œâ”€ Pode ser revogado/alterado se necessÃ¡rio
  â””â”€ Se vazar, solicitar novo ao administrador

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ RESUMO FINAL:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Fluxo simples:
EMAIL â†’ POWER AUTOMATE â†’ API LARAVEL â†’ BANCO DE DADOS â†’ DASHBOARD

O que vocÃª precisa fazer:
âœ… Configurar Power Automate (copiar JSON no Body)
âœ… Enviar email para suporte.dev@plansul.com.br
âœ… Escrever dados no corpo do email (linguagem natural)
âœ… Incluir quantidade nos itens (obrigatÃ³rio)

O sistema faz:
âœ… Recebe email
âœ… Extrai dados
âœ… Busca projeto inteligentemente
âœ… Valida campos obrigatÃ³rios
âœ… Cria solicitaÃ§Ã£o no banco
âœ… Retorna confirmaÃ§Ã£o

Resultado:
âœ… SolicitaÃ§Ã£o aparece no dashboard
âœ… Pronta para processamento
âœ… Com todos os detalhes capturados

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Data: 26/01/2026 18:30
Status: âœ… Sistema 100% integrado e funcional
