================================================================================
DOCUMENTAÃ‡ÃƒO COMPLETA DO SISTEMA ESTOQUE_PLANSUL_LARAVEL
VersÃ£o: 2.0 (Atualizado 2026-02-02)
Autor: Equipe de Desenvolvimento Plansul
Objetivo: ReferÃªncia Ãºnica e completa para desenvolvimento e manutenÃ§Ã£o
================================================================================

ÃNDICE GERAL:
1. VisÃ£o Geral do Sistema
2. Stack TecnolÃ³gico Completo
3. Arquitetura da AplicaÃ§Ã£o
4. Banco de Dados e Modelos
5. PadrÃµes de CÃ³digo ObrigatÃ³rios
6. Design e Interface do UsuÃ¡rio
7. Componentes ReutilizÃ¡veis
8. Fluxos de NegÃ³cio Principais
9. IntegraÃ§Ã£o com KingHost
10. Scripts e UtilitÃ¡rios
11. SeguranÃ§a e PermissÃµes
12. Checklist de Desenvolvimento

================================================================================
1. VISÃƒO GERAL DO SISTEMA
================================================================================

NOME OFICIAL: Estoque_Plansul_Laravel
TIPO: AplicaÃ§Ã£o Web de Gerenciamento de PatrimÃ´nio Corporativo
PROPÃ“SITO: Controlar, rastrear e gerenciar bens patrimoniais da empresa Plansul
AMBIENTE ALVO: KingHost (servidor Linux compartilhado)
VERSÃƒO LARAVEL: 11.x
VERSÃƒO PHP: 8.2+

FUNCIONALIDADES PRINCIPAIS:
- Cadastro e manutenÃ§Ã£o de patrimÃ´nios (bens)
- AtribuiÃ§Ã£o de patrimÃ´nios a funcionÃ¡rios e locais
- Auditoria e rastreabilidade de movimentaÃ§Ãµes
- ImportaÃ§Ã£o em lote de dados (CSV/TXT)
- ExportaÃ§Ã£o de relatÃ³rios (PDF, Excel)
- Gerenciamento de projetos (cÃ©lulas organizacionais)
- Controle de locais fÃ­sicos por projeto
- HistÃ³rico completo de movimentaÃ§Ãµes (tabela movpartr)
- IntegraÃ§Ã£o com dados do KingHost (sincronizaÃ§Ã£o)
- Dark mode (tema claro e escuro)

USUÃRIOS-ALVO:
- Consultores: Acesso total ao sistema, gerenciam patrimÃ´nios e usuÃ¡rios
- Supervisores: Acesso a relatÃ³rios e movimentaÃ§Ãµes de seu setor
- FuncionÃ¡rios: Visualizam e confirmam patrimÃ´nios atribuÃ­dos a eles
- Administradores: Gerenciam usuÃ¡rios, permissÃµes e sistema

================================================================================
2. STACK TECNOLÃ“GICO COMPLETO
================================================================================

BACKEND:
â”œâ”€ Framework: Laravel 11.x (Framework web PHP)
â”œâ”€ Linguagem: PHP 8.2+ (Tipagem forte, attributes, etc)
â”œâ”€ Gerenciador de DependÃªncias: Composer
â”œâ”€ Banco de Dados: MySQL 5.7+ (InnoDB, suporta transaÃ§Ãµes)
â”œâ”€ AutenticaÃ§Ã£o: Laravel Sanctum + Auth Nativa
â”œâ”€ Cache: Redis/File (configurÃ¡vel em .env)
â”œâ”€ Fila de Jobs: Database Queue
â”œâ”€ Logs: Storage/logs (PSR-3 compliant)
â””â”€ ORM: Eloquent (abstraÃ§Ã£o de BD)

FRONTEND:
â”œâ”€ Templating: Blade (Templates Laravel)
â”œâ”€ Styling: Tailwind CSS 3.x (utility-first CSS)
â”œâ”€ Dark Mode: Tailwind dark: prefix (automÃ¡tico com JS)
â”œâ”€ Interatividade: Alpine.js 3.x (reatividade leve, sem build step obrigatÃ³rio)
â”œâ”€ Build Tool: Vite (bundler ES modules moderno)
â”œâ”€ JavaScript: ES6+ moderno
â””â”€ Pacotes CSS: @tailwindcss/forms (para inputs)

TOOLING & CI/CD:
â”œâ”€ Version Control: Git (GitHub)
â”œâ”€ Linting PHP: PHPStan + Laravel Pint
â”œâ”€ Code Style: PSR-12 (Laravel padrÃ£o)
â”œâ”€ NPM Scripts: build (prod), dev (watch), lint
â”œâ”€ Environment: .env (Laravel padrÃ£o, com DB_HOST_KINGHOST separado)
â””â”€ Deployment: SSH manual para KingHost (nÃ£o automatizado)

DEPENDENCIES PRINCIPAIS (composer.json):
- laravel/framework (11.x)
- laravel/sanctum (autenticaÃ§Ã£o API)
- laravel/tinker (REPL interativo)
- barryvdh/laravel-dompdf (PDF generation)
- maatwebsite/excel (Excel export)
- predis/predis (cliente Redis, se usar cache)

DEPENDENCIES NPM (package.json):
- tailwindcss
- alpinejs
- vite
- @vitejs/plugin-laravel
- @tailwindcss/forms

================================================================================
3. ARQUITETURA DA APLICAÃ‡ÃƒO
================================================================================

ESTRUTURA DE DIRETÃ“RIOS:

app/
â”œâ”€ Console/Commands/         [Comandos Artisan customizados]
â”‚  â”œâ”€ ImportarTodosPatrimonios.php
â”‚  â”œâ”€ SincronizarKinghost.php
â”‚  â”œâ”€ users:unify.php        [Merge de usuÃ¡rios duplicados]
â”‚  â””â”€ ... (outros comandos)
â”œâ”€ Http/
â”‚  â”œâ”€ Controllers/            [LÃ³gica de roteamento HTTP]
â”‚  â”‚  â”œâ”€ PatrimonioController.php     (CRUD patrimÃ´nios)
â”‚  â”‚  â”œâ”€ UserController.php           (Gerenciar usuÃ¡rios)
â”‚  â”‚  â”œâ”€ ProjetoController.php        (Projetos/cÃ©lulas)
â”‚  â”‚  â”œâ”€ LocalController.php          (Locais fÃ­sicos)
â”‚  â”‚  â”œâ”€ RelatorioController.php      (RelatÃ³rios/Exports)
â”‚  â”‚  â””â”€ ... (outros)
â”‚  â”œâ”€ Requests/               [Form Request Validation]
â”‚  â”‚  â”œâ”€ StorePatrimonioRequest.php
â”‚  â”‚  â”œâ”€ UpdatePatrimonioRequest.php
â”‚  â”‚  â””â”€ ...
â”‚  â””â”€ Middleware/             [Filtros HTTP]
â”‚     â”œâ”€ Authenticate.php
â”‚     â”œâ”€ CheckPermission.php   (AutorizaÃ§Ã£o por permissÃ£o)
â”‚     â””â”€ ...
â”œâ”€ Models/                    [Eloquent Models (ORM)]
â”‚  â”œâ”€ Patrimonio.php          (PK: NUSEQPATR)
â”‚  â”œâ”€ User.php                (UsuÃ¡rios)
â”‚  â”œâ”€ Projeto.php             (CÃ©lulas/Projetos)
â”‚  â”œâ”€ Local.php               (Locais fÃ­sicos)
â”‚  â”œâ”€ Funcionario.php         (Dados de RH)
â”‚  â”œâ”€ MovPartr.php            (HistÃ³rico de movimentos)
â”‚  â”œâ”€ ObjetoPatr.php          (Tipos de objeto)
â”‚  â””â”€ ... (outros)
â”œâ”€ Services/                  [LÃ³gica de NegÃ³cio Encapsulada]
â”‚  â”œâ”€ PatrimonioService.php   (OperaÃ§Ãµes complexas em patrimÃ´nios)
â”‚  â”œâ”€ ImportacaoService.php   (ImportaÃ§Ã£o em lote)
â”‚  â”œâ”€ RelatorioService.php    (GeraÃ§Ã£o de relatÃ³rios)
â”‚  â””â”€ ...
â”œâ”€ Observers/                 [Event Listeners para modelos]
â”‚  â”œâ”€ PatrimonioObserver.php  (Log de criaÃ§Ã£o/update/delete)
â”‚  â””â”€ ...
â”œâ”€ Policies/                  [AutorizaÃ§Ã£o granular]
â”‚  â”œâ”€ PatrimonioPolicy.php    (Quem pode editar qual patrimÃ´nio)
â”‚  â””â”€ ...
â”œâ”€ Helpers/                   [FunÃ§Ãµes auxiliares]
â”‚  â”œâ”€ FormatarHelpers.php     (FormataÃ§Ã£o de dados)
â”‚  â””â”€ ...
â”œâ”€ Providers/                 [Service Providers]
â”‚  â”œâ”€ AppServiceProvider.php  (Registro de serviÃ§os globais)
â”‚  â””â”€ ...
â””â”€ View/                      [View Composers e variÃ¡veis globais]

routes/
â”œâ”€ web.php                   [Rotas autenticadas (web)]
â”œâ”€ auth.php                  [Rotas de autenticaÃ§Ã£o (login/logout)]
â”œâ”€ console.php               [Comandos CLI]
â””â”€ api.php                   [APIs (se houver)]

resources/
â”œâ”€ views/
â”‚  â”œâ”€ components/            [Componentes Blade reutilizÃ¡veis]
â”‚  â”‚  â”œâ”€ action-button.blade.php      (BotÃµes edit/delete/view/add/export)
â”‚  â”‚  â”œâ”€ status-badge.blade.php       (Badges coloridas de status)
â”‚  â”‚  â”œâ”€ table-header.blade.php       (Headers com sort)
â”‚  â”‚  â”œâ”€ patrimonio-form.blade.php    (Form ediÃ§Ã£o/criaÃ§Ã£o)
â”‚  â”‚  â”œâ”€ search-filter.blade.php      (Barra de busca)
â”‚  â”‚  â””â”€ ...
â”‚  â”œâ”€ layouts/               [Layouts base]
â”‚  â”‚  â”œâ”€ app.blade.php       (Layout padrÃ£o com navbar)
â”‚  â”‚  â””â”€ guest.blade.php     (Layout login)
â”‚  â”œâ”€ patrimonios/           [Views de patrimÃ´nios]
â”‚  â”‚  â”œâ”€ index.blade.php     (Listagem com filtros)
â”‚  â”‚  â”œâ”€ show.blade.php      (Visualizar 1 patrimÃ´nio)
â”‚  â”‚  â”œâ”€ edit.blade.php      (Editar patrimÃ´nio)
â”‚  â”‚  â”œâ”€ create.blade.php    (Criar novo patrimÃ´nio)
â”‚  â”‚  â””â”€ ...
â”‚  â”œâ”€ usuarios/              [Views de usuÃ¡rios]
â”‚  â”œâ”€ projetos/              [Views de projetos]
â”‚  â”œâ”€ relatÃ³rios/            [Views de relatÃ³rios]
â”‚  â””â”€ ...
â”œâ”€ css/
â”‚  â””â”€ app.css                (CSS global, imports de Tailwind)
â”œâ”€ js/
â”‚  â”œâ”€ app.js                 (Entry point Vite)
â”‚  â”œâ”€ modules/               [MÃ³dulos JavaScript reutilizÃ¡veis]
â”‚  â”‚  â”œâ”€ PatrimonioActions.js (CRUD de patrimÃ´nios via AJAX)
â”‚  â”‚  â”œâ”€ SearchFilter.js     (Busca com debounce)
â”‚  â”‚  â””â”€ ...
â”‚  â””â”€ ...
â””â”€ sass/                     (Preprocessador SCSS, se usado)

config/
â”œâ”€ app.php                   [ConfiguraÃ§Ã£o geral]
â”œâ”€ database.php              [ConexÃµes BD (local + KingHost)]
â”œâ”€ auth.php                  [Guards e Providers de autenticaÃ§Ã£o]
â”œâ”€ cache.php                 [Cache driver]
â”œâ”€ mail.php                  [Email driver]
â”œâ”€ filesystems.php           [Storage disks]
â”œâ”€ telas.php                 [CUSTOM: Mapeamento de telas/cÃ©lulas]
â”œâ”€ historico.php             [CUSTOM: Config de logs histÃ³ricos]
â”œâ”€ solicitacoes_bens.php     [CUSTOM: Config de workflow]
â””â”€ logging.php               [Logging PSR-3]

database/
â”œâ”€ migrations/               [Versionamento de schema]
â”‚  â”œâ”€ 2014_10_12_000000_create_users_table.php
â”‚  â”œâ”€ 2025_09_01_add_patrimonio_fields.php
â”‚  â””â”€ ...
â”œâ”€ seeders/                  [Dados iniciais]
â”‚  â”œâ”€ DatabaseSeeder.php
â”‚  â”œâ”€ ProjetoSeeder.php
â”‚  â””â”€ ...
â””â”€ imports/                  [Dados de seed em TXT/JSON]

storage/
â”œâ”€ logs/                     [Logs de aplicaÃ§Ã£o]
â”‚  â””â”€ laravel.log
â”œâ”€ backups/                  [Backups de BD e dados]
â”‚  â”œâ”€ patrimonio_*.json
â”‚  â”œâ”€ usuarios_*.json
â”‚  â””â”€ ...
â””â”€ app/
   â”œâ”€ exports/              [Arquivos exportados (PDF, Excel)]
   â”œâ”€ imports/              [Arquivos importados/processados]
   â””â”€ ...

public/
â”œâ”€ index.php                 [Entry point Laravel]
â”œâ”€ js/                       [JavaScript compilado (Vite build output)]
â”œâ”€ css/                      [CSS compilado (Vite build output)]
â”œâ”€ img/                      [Imagens estÃ¡ticas]
â””â”€ build/                    [Artefatos Vite (buildado automaticamente)]

scripts/                      [One-offs, scripts de manutenÃ§Ã£o, nÃ£o ficam no deploy]
â”œâ”€ kinghost_sync_master.php
â”œâ”€ criar_backup.ps1
â”œâ”€ start_laravel_server.ps1
â””â”€ ... (ferramenta temporÃ¡rios)

archive/
â””â”€ backups/                  [Backups histÃ³ricos e arquivos preservados]

FLUXO ARQUITETURAL:

RequisiÃ§Ã£o HTTP
    â†“
routes/web.php (Match de rota)
    â†“
app/Http/Controllers/XController.php
    â”œâ”€ Valida com Form Request
    â””â”€ Chama Service ou Model
        â†“
    app/Services/XService.php (LÃ³gica de negÃ³cio)
        â””â”€ Manipula Models
            â†“
        app/Models/X.php (Eloquent)
            â””â”€ Dispara Observers
            â”œâ”€ Executa logs via Log::info()
            â””â”€ Retorna dados
        â†“
    Controller retorna View ou JSON
        â†“
resources/views/X/show.blade.php
    â””â”€ Inclui componentes: <x-action-button>, <x-status-badge>, etc
    â†“
HTML + Alpine.js (interatividade)
    â””â”€ public/js/modules/XActions.js
    â†“
Browser renderiza

================================================================================
4. BANCO DE DADOS E MODELOS
================================================================================

FONTE DE VERDADE: KingHost (mysql07-farm10.kinghost.net)
BANCO LOCAL: plansul (sincronizado periodicamente)

TABELAS CRÃTICAS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PATR (PatrimÃ´nios - Core da aplicaÃ§Ã£o)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: NUSEQPATR (int)        - Sequencial Ãºnico
â”‚ FK: CODOBJETO â†’ objetopatr.NUSEQOBJ
â”‚ FK: CDMATRFUNCIONARIO â†’ funcionarios.CDMATRFUNCIONARIO
â”‚ FK: CDPROJETO + CDLOCAL â†’ locais_projeto
â”‚
â”‚ Colunas principais:
â”‚ - NUPATRIMONIO (varchar 20)    - CÃ³digo visual do bem (ex: "PAT-2025-001")
â”‚ - DEPATRIMONIO (varchar 300)   - DescriÃ§Ã£o do bem
â”‚ - CODOBJETO (int)              - Tipo/Objeto do patrimÃ´nio
â”‚ - CDPROJETO (varchar 4)        - Projeto/CÃ©lula
â”‚ - CDLOCAL (varchar 4)          - Local fÃ­sico
â”‚ - CDMATRFUNCIONARIO (varchar)  - FuncionÃ¡rio responsÃ¡vel
â”‚ - SITUACAO (varchar 20)        - Status (Ativo, Inativo, Baixado, etc)
â”‚ - DTAQUISICAO (date)           - Data de aquisiÃ§Ã£o
â”‚ - DTBAIXA (date)               - Data de baixa (se retirado)
â”‚ - USUARIO (varchar 20)         - Ãšltimo usuÃ¡rio a editar
â”‚ - DTOPERACAO (datetime)        - Timestamp Ãºltima operaÃ§Ã£o
â”‚
â”‚ Indices:
â”‚ - PRIMARY (NUSEQPATR)
â”‚ - INDEX (CDPROJETO, CDLOCAL)
â”‚ - INDEX (CDMATRFUNCIONARIO)
â”‚ - INDEX (SITUACAO)
â”‚ - INDEX (DTOPERACAO DESC)
â”‚
â”‚ Registros: ~11.394 (em produÃ§Ã£o)
â”‚ Eloquent Model: app/Models/Patrimonio.php
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LOCAIS_PROJETO (Mapeamento de locais por projeto)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (int)
â”‚ FK: tabfant_id â†’ tabfant.id
â”‚
â”‚ Colunas:
â”‚ - id (int)
â”‚ - cdlocal (varchar 4)          - CÃ³digo do local
â”‚ - delocal (varchar 150)        - Nome/descriÃ§Ã£o
â”‚ - tabfant_id (int)             - ID do projeto (SEED = 10000002)
â”‚
â”‚ Registros: ~1.939
â”‚ Eloquent Model: app/Models/Local.php
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TABFANT (Projetos/CÃ©lulas)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (int)
â”‚
â”‚ Colunas:
â”‚ - id (int)                     - Sequencial (ex: 10000002 = SEDE)
â”‚ - CDPROJETO (varchar 4)        - CÃ³digo projeto (ex: "8" = SEDE)
â”‚ - NOMEPROJETO (varchar 100)    - Nome projeto (ex: "SEDE PLANSUL")
â”‚ - (outros campos conforme KingHost)
â”‚
â”‚ Registros: ~877
â”‚ Eloquent Model: app/Models/Projeto.php
â”‚ ESPECIAL: ID 10000002 Ã© "SEDE" (33 locais)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OBJETOPATR (Tipos/Objetos de patrimÃ´nios)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: NUSEQOBJ (int)
â”‚ FK: NUSEQTIPOPATR â†’ tipopatr.id
â”‚
â”‚ Colunas:
â”‚ - NUSEQOBJ (int)               - Sequencial
â”‚ - NUSEQTIPOPATR (int)          - Tipo
â”‚ - DEOBJETO (varchar 300)       - DescriÃ§Ã£o (expandida em 2025-12-11)
â”‚
â”‚ Registros: ~1.208 (restaurados em 2025-12-11)
â”‚ Eloquent Model: app/Models/ObjetoPatr.php
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USERS (UsuÃ¡rios do sistema)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (int)
â”‚
â”‚ Colunas:
â”‚ - id (int)
â”‚ - name (varchar 255)
â”‚ - email (varchar 255)          - Ãšnico
â”‚ - password (hashed)
â”‚ - email_verified_at (datetime)
â”‚ - remember_token
â”‚ - created_at, updated_at
â”‚ - (custom fields podem ser adicionados)
â”‚
â”‚ Eloquent Model: app/Models/User.php
â”‚ AutenticaÃ§Ã£o: Laravel Auth + Sanctum (tokens)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MOVPARTR (HistÃ³rico de movimentaÃ§Ãµes)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK: id (int)
â”‚
â”‚ Colunas:
â”‚ - id (int)
â”‚ - patrimonio_id â†’ patr.NUSEQPATR
â”‚ - de_cdlocal (varchar 4)       - Local de origem
â”‚ - para_cdlocal (varchar 4)     - Local destino
â”‚ - de_funcionario (varchar)     - FuncionÃ¡rio origem
â”‚ - para_funcionario (varchar)   - FuncionÃ¡rio destino
â”‚ - data_movimento (datetime)
â”‚ - usuario (varchar)            - Quem registrou
â”‚ - motivo (text)                - Motivo da movimentaÃ§Ã£o
â”‚
â”‚ Registros: ~4.619
â”‚ Eloquent Model: app/Models/MovPartr.php
â”‚ PropÃ³sito: Auditoria e rastreabilidade
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RELACIONAMENTOS (Eloquent):

Patrimonio
â”œâ”€ belongs to ObjetoPatr (CODOBJETO â†’ NUSEQOBJ)
â”œâ”€ belongs to Projeto (CDPROJETO)
â”œâ”€ belongs to Local (CDLOCAL)
â”œâ”€ belongs to User (CDMATRFUNCIONARIO via FK customizada)
â”œâ”€ has many MovPartr (movimentos histÃ³ricos)
â””â”€ has many Auditoria (logs de mudanÃ§a)

User
â”œâ”€ has many Patrimonio (patrimÃ´nios atribuÃ­dos)
â””â”€ has many AuditoriaLog (aÃ§Ãµes do usuÃ¡rio)

Local
â”œâ”€ belongs to Projeto (tabfant_id)
â””â”€ has many Patrimonio

Projeto
â””â”€ has many Local

INDICES CRÃTICOS (Performance):

CREATE INDEX idx_patr_cdprojeto_cdlocal ON patr(CDPROJETO, CDLOCAL);
CREATE INDEX idx_patr_cdmatrfuncionario ON patr(CDMATRFUNCIONARIO);
CREATE INDEX idx_patr_situacao ON patr(SITUACAO);
CREATE INDEX idx_patr_dtoperacao ON patr(DTOPERACAO DESC);
CREATE INDEX idx_patr_codobjeto ON patr(CODOBJETO);
CREATE INDEX idx_locais_tabfant_id ON locais_projeto(tabfant_id);

================================================================================
5. PADRÃ•ES DE CÃ“DIGO OBRIGATÃ“RIOS
================================================================================

PRINCÃPIO FUNDAMENTAL:
"Todo cÃ³digo deve ser manutenÃ­vel, escalÃ¡vel, de fÃ¡cil evoluÃ§Ã£o e seguir as
convenÃ§Ãµes do projeto para que qualquer desenvolvedor compreenda rapidamente."

5.1 NOMENCLATURA

PHP/Classes/MÃ©todos:
â”œâ”€ Classes: PascalCase (PatrimonioService, MovPartrController)
â”œâ”€ MÃ©todos: camelCase (criarPatrimonio, validarDados)
â”œâ”€ Constantes: UPPER_SNAKE_CASE (DB_HOST_KINGHOST)
â”œâ”€ VariÃ¡veis: camelCase (numSequencial, patrimonios)
â””â”€ Namespaces: PSR-4 (App\Models, App\Http\Controllers)

Banco de Dados:
â”œâ”€ Tabelas: snake_case (patr, movpartr, locais_projeto, tabfant)
â”œâ”€ Colunas: UPPER_SNAKE_CASE com prefixo (NUSEQPATR, DEPATRIMONIO)
â”œâ”€ PKs: NUSEQ* ou id (sequencial)
â”œâ”€ FKs: ColumnName_id (patrimonio_id)
â””â”€ Booleans: is_* ou tem_* (is_ativo, tem_permissao)

Blade/Frontend:
â”œâ”€ Componentes: kebab-case (<x-action-button>, <x-status-badge>)
â”œâ”€ IDs/Classes Tailwind: kebab-case (sort-patrimonio-name)
â”œâ”€ Dados customizados: data-* (data-delete-patrimonio)
â””â”€ VariÃ¡veis JS: camelCase (formData, searchFilter)

5.2 COMENTÃRIOS E DOCUMENTAÃ‡ÃƒO

PHPDoc para Classes (ObrigatÃ³rio):
```
/**
 * PatrimonioService
 *
 * Encapsula lÃ³gica de negÃ³cio de patrimÃ´nios: criaÃ§Ã£o, atualizaÃ§Ã£o,
 * deleÃ§Ã£o, pesquisa e estatÃ­sticas. Integra com banco local e KingHost.
 *
 * @package App\Services
 * @author Equipe Plansul
 * @version 2.0
 */
class PatrimonioService
{
    // ...
}
```

PHPDoc para MÃ©todos (ObrigatÃ³rio):
```
/**
 * Criar novo patrimÃ´nio com validaÃ§Ã£o e log
 *
 * @param array $dados Dados do patrimÃ´nio (NUPATRIMONIO, DEPATRIMONIO, etc)
 * @param User $usuario UsuÃ¡rio responsÃ¡vel
 * @return Patrimonio
 * @throws ValidationException Se dados invÃ¡lidos
 */
public function criar(array $dados, User $usuario): Patrimonio
{
    // ...
}
```

ComentÃ¡rios Inline (Explicativos, nÃ£o Ã³bvios):
```
// Ordem por DTOPERACAO DESC para trazer ediÃ§Ãµes recentes primeiro
$query->orderBy('DTOPERACAO', 'desc');
```

ComentÃ¡rios BLOQUEADOS (NÃ£o fazer):
```
// âŒ Ã“bvio demais
$name = $user->name; // pega o nome do usuÃ¡rio

// âŒ CÃ³digo comentado (remover)
// $patrimonio->delete();
// Patrimonio::where('id', $id)->delete();

// âŒ Redundante
$data = [];  // array vazio
```

5.3 LOGS PADRONIZADOS COM EMOJIS

Formato:
Log::LEVEL('ğŸš€ [CONTEXTO] mensagem descritiva', ['chave' => $valor]);

Emojis PadrÃ£o:
â”œâ”€ ğŸš€ InicializaÃ§Ã£o / Start
â”œâ”€ ğŸ“‹ Listagem / Consulta
â”œâ”€ â• CriaÃ§Ã£o / Insert
â”œâ”€ âœï¸ AtualizaÃ§Ã£o / Update
â”œâ”€ ğŸ—‘ï¸ DeleÃ§Ã£o / Delete
â”œâ”€ âœ… Sucesso / ConfirmaÃ§Ã£o
â”œâ”€ âš ï¸ Aviso / Warning
â”œâ”€ âŒ Erro / Failure
â”œâ”€ ğŸ” Busca / Search
â”œâ”€ ğŸ“Š EstatÃ­sticas / Analytics
â”œâ”€ ğŸ“¡ HTTP Request
â”œâ”€ ğŸ“¥ HTTP Response
â”œâ”€ ğŸ” SeguranÃ§a / Authorization
â”œâ”€ ğŸ’¾ Backup / Storage
â”œâ”€ ğŸ”„ SincronizaÃ§Ã£o / Sync
â””â”€ ğŸ“§ NotificaÃ§Ã£o / Email

Exemplos:
```
Log::info('âœ… [PatrimonioService] patrimÃ´nio criado', [
    'nuseqpatr' => $patrimonio->NUSEQPATR,
    'usuario' => Auth::user()->email,
]);

Log::warning('âš ï¸ [ImportService] 5 registros com erro', [
    'linha' => 42,
    'erro' => 'CDLOCAL invÃ¡lido',
    'arquivo' => 'patrimonio_import.txt',
]);

Log::error('âŒ [KingHostSync] falha ao conectar', [
    'host' => config('database.kinghost_host'),
    'exception' => $e->getMessage(),
]);
```

5.4 TRATAMENTO DE ERROS

Sempre encapsular em try-catch:
```
try {
    $patrimonio = $this->criar($dados);
    Log::info('âœ… [Patrimonio] criado', ['id' => $patrimonio->NUSEQPATR]);
    return response()->json(['success' => true, 'patrimonio' => $patrimonio]);
} catch (ValidationException $e) {
    Log::warning('âš ï¸ [Patrimonio] validaÃ§Ã£o falhou', ['errors' => $e->errors()]);
    return response()->json(['errors' => $e->errors()], 422);
} catch (Exception $e) {
    Log::error('âŒ [Patrimonio] erro inesperado', ['exception' => $e->getMessage()]);
    return response()->json(['error' => 'Erro interno'], 500);
}
```

Nunca deixar Exception sem log e sem resposta adequada ao cliente.

5.5 SEPARAÃ‡ÃƒO DE RESPONSABILIDADES

Controllers: Apenas HTTP
```
// âœ… CORRETO
public function store(StorePatrimonioRequest $request)
{
    $patrimonio = $this->patrimonioService->criar($request->validated());
    return redirect()->route('patrimonios.show', $patrimonio)->with('success', 'Criado!');
}

// âŒ ERRADO (lÃ³gica no controller)
public function store(Request $request)
{
    DB::beginTransaction();
    $patr = Patrimonio::create($request->all());
    MovPartr::create(['patrimonio_id' => $patr->id, ...]);
    // ... 50 linhas de lÃ³gica
}
```

Services: LÃ³gica de NegÃ³cio
```
// âœ… CORRETO em PatrimonioService
public function criar(array $dados): Patrimonio
{
    DB::beginTransaction();
    try {
        $patrimonio = Patrimonio::create($dados);
        MovPartr::create(['patrimonio_id' => $patrimonio->id, 'acao' => 'CRIACAO']);
        $this->notificarFuncionario($patrimonio);
        DB::commit();
        Log::info('âœ… [Service] patrimÃ´nio criado', ['id' => $patrimonio->NUSEQPATR]);
        return $patrimonio;
    } catch (Exception $e) {
        DB::rollBack();
        Log::error('âŒ [Service] erro ao criar', ['exception' => $e->getMessage()]);
        throw $e;
    }
}
```

Models: Apenas Relacionamentos e Escopos
```
// âœ… CORRETO em Patrimonio Model
class Patrimonio extends Model
{
    public function objeto() {
        return $this->belongsTo(ObjetoPatr::class, 'CODOBJETO');
    }

    public function scopeAtivos($query) {
        return $query->where('SITUACAO', 'Ativo');
    }

    public function scopeNoPeriodo($query, $de, $ate) {
        return $query->whereBetween('DTOPERACAO', [$de, $ate]);
    }
}
```

5.6 REUTILIZAÃ‡ÃƒO DE CÃ“DIGO (DRY)

Componentes Blade para HTML Repetido:
```
// âŒ ERRADO - HTML duplicado em vÃ¡rias views
<a href="/patrimonios/{{ $p->id }}/edit" class="...">Editar</a>
<a href="/patrimonios/{{ $p->id }}/edit" class="...">Editar</a>

// âœ… CORRETO - Criar componente
// resources/views/components/action-button.blade.php
<x-action-button :href="route('patrimonios.edit', $patrimonio)" action="edit" />

// Usar em views:
<x-action-button :href="route('patrimonios.edit', $patrimonio)" action="edit" />
```

MÃ³dulos JavaScript para LÃ³gica Repetida:
```
// âœ… public/js/modules/PatrimonioActions.js
window.PatrimonioActions = (() => {
    const delete = (id) => fetch(`/api/patrimonios/${id}`, { method: 'DELETE' });
    const rebind = (id, user) => fetch(`/api/patrimonios/${id}/rebind`, { method: 'POST', body: JSON.stringify({user}) });
    return { delete, rebind };
})();

// Em views:
<button @click="PatrimonioActions.delete(patrimonio.id)">Deletar</button>
```

Services para LÃ³gica Compartilhada:
```
// âœ… app/Services/BuscaPatrimonioService.php
class BuscaPatrimonioService
{
    public function buscar(string $termo): Collection {
        return Patrimonio::where('NUPATRIMONIO', 'like', "%$termo%")
            ->orWhere('DEPATRIMONIO', 'like', "%$termo%")
            ->orderBy('DTOPERACAO', 'desc')
            ->get();
    }
}

// Usar em mÃºltiplos controllers:
$resultados = app(BuscaPatrimonioService::class)->buscar($termo);
```

5.7 VALIDAÃ‡ÃƒO E FORM REQUESTS

Criar FormRequest para cada operaÃ§Ã£o:
```
// âœ… app/Http/Requests/StorePatrimonioRequest.php
class StorePatrimonioRequest extends FormRequest
{
    public function authorize(): bool {
        return auth()->check() && auth()->user()->can('create', Patrimonio::class);
    }

    public function rules(): array {
        return [
            'NUPATRIMONIO' => 'required|string|unique:patr',
            'DEPATRIMONIO' => 'required|string|max:300',
            'CODOBJETO' => 'required|exists:objetopatr,NUSEQOBJ',
            'CDPROJETO' => 'required|exists:tabfant,CDPROJETO',
            'CDLOCAL' => 'required|string',
            'SITUACAO' => 'in:Ativo,Inativo,Baixado',
        ];
    }

    public function messages(): array {
        return [
            'NUPATRIMONIO.required' => 'NÃºmero do patrimÃ´nio Ã© obrigatÃ³rio',
            'NUPATRIMONIO.unique' => 'Este nÃºmero jÃ¡ existe no banco',
            'CODOBJETO.exists' => 'Objeto selecionado nÃ£o existe',
        ];
    }
}
```

Usar em Controller:
```
public function store(StorePatrimonioRequest $request) {
    $patrimonio = $this->service->criar($request->validated());
    // ...
}
```

================================================================================
6. DESIGN E INTERFACE DO USUÃRIO
================================================================================

FILOSOFIA DE DESIGN: Simplicidade, clareza, consistÃªncia

TECNOLOGIA: Tailwind CSS 3.x (utility-first) + Alpine.js (interatividade)
TEMAS: Light mode (padrÃ£o) + Dark mode (automÃ¡tico com toggle)

6.1 PALETA DE CORES

Cores PrimÃ¡rias:
â”œâ”€ Indigo: #4F46E5 (aÃ§Ã£o principal, botÃµes primÃ¡rios)
â”œâ”€ Blue: #3B82F6 (informaÃ§Ã£o, links)
â”œâ”€ Green: #10B981 (sucesso, ativa)
â”œâ”€ Red: #EF4444 (perigo, deletar, erro)
â”œâ”€ Amber: #F59E0B (aviso, atenÃ§Ã£o)
â””â”€ Gray: #6B7280 (neutro, texto secundÃ¡rio)

Backgrounds:
â”œâ”€ Light mode: white (#FFFFFF), gray-50 (#F9FAFB), gray-100 (#F3F4F6)
â”œâ”€ Dark mode: gray-900 (#111827), gray-800 (#1F2937), gray-700 (#374151)
â””â”€ Borders: gray-200 (light), gray-700 (dark)

ObrigaÃ§Ã£o ABSOLUTA (Dark Mode):
TODA COR DEVE TER SEU EQUIVALENTE dark:

âŒ ERRADO:
<div class="bg-white">
  <p class="text-gray-900">Texto</p>
</div>

âœ… CORRETO:
<div class="bg-white dark:bg-gray-900">
  <p class="text-gray-900 dark:text-gray-100">Texto</p>
</div>

6.2 LAYOUT E GRIDS

Mobile-first (padrÃ£o):
- 1 coluna em mobile
- Expandir em md: (768px) e lg: (1024px)

Exemplo de grid de formulÃ¡rio:
```html
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div class="lg:col-span-2">Projeto (2 colunas em lg)</div>
    <div>SituaÃ§Ã£o (1 coluna em lg)</div>
    <div>Peso</div>
    <div>Tamanho</div>
    <div>Data AquisiÃ§Ã£o</div>
</div>
```

6.3 COMPONENTES PADRÃƒO

Inputs:
```html
<label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
    Label
</label>
<input type="text" placeholder="..."
    class="block w-full h-8 text-xs border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500" />
```

Selects:
```html
<select class="block w-full h-8 text-xs border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500">
    <option>OpÃ§Ã£o 1</option>
</select>
```

BotÃµes:
```html
<!-- PrimÃ¡rio (aÃ§Ã£o principal) -->
<button class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 dark:hover:bg-indigo-500 text-white text-xs font-medium rounded-md">
    AÃ§Ã£o Principal
</button>

<!-- SecundÃ¡rio (aÃ§Ã£o menos importante) -->
<button class="px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-gray-100 text-xs font-medium rounded-md">
    AÃ§Ã£o SecundÃ¡ria
</button>

<!-- Perigo (delete) -->
<button class="px-4 py-2 bg-red-600 hover:bg-red-700 dark:hover:bg-red-500 text-white text-xs font-medium rounded-md">
    Deletar
</button>
```

Badges/Status:
```html
<!-- Verde (ativo) -->
<span class="px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 text-xs font-medium rounded">
    Ativo
</span>

<!-- Vermelho (inativo) -->
<span class="px-2 py-1 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-100 text-xs font-medium rounded">
    Inativo
</span>
```

Tabelas:
```html
<table class="min-w-full border-collapse border border-gray-200 dark:border-gray-700">
    <thead class="bg-gray-100 dark:bg-gray-800">
        <tr>
            <th class="border border-gray-200 dark:border-gray-700 px-4 py-2 text-left text-xs font-medium text-gray-900 dark:text-gray-100">
                Coluna
            </th>
        </tr>
    </thead>
    <tbody>
        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
            <td class="border border-gray-200 dark:border-gray-700 px-4 py-2 text-xs text-gray-900 dark:text-gray-100">
                Dado
            </td>
        </tr>
    </tbody>
</table>
```

Modais:
```html
<div x-show="open" class="fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-md w-full">
        <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">TÃ­tulo</h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 mb-6">ConteÃºdo</p>
        <div class="flex gap-2">
            <button @click="open = false" class="...">Cancelar</button>
            <button @click="confirmar()" class="...">Confirmar</button>
        </div>
    </div>
</div>
```

6.4 RESPONSIVIDADE

Breakpoints Tailwind:
â”œâ”€ sm: 640px
â”œâ”€ md: 768px
â”œâ”€ lg: 1024px
â”œâ”€ xl: 1280px
â””â”€ 2xl: 1536px

Usar: md:col-span-2, lg:grid-cols-3, sm:text-xs, etc

6.5 ACESSIBILIDADE

ObrigaÃ§Ãµes:
- Todos inputs devem ter <label>
- Usar aria-label para Ã­cones sem texto
- Cores nÃ£o devem ser Ãºnica forma de comunicaÃ§Ã£o (adicionar Ã­cones)
- Contraste mÃ­nimo 4.5:1 (jÃ¡ garantido pelo Tailwind)
- Teclado navegÃ¡vel (tabindex, focus outline)

================================================================================
7. COMPONENTES REUTILIZÃVEIS
================================================================================

LOCALIZAÃ‡ÃƒO: resources/views/components/

7.1 ACTION-BUTTON

Arquivo: action-button.blade.php

Props:
- href (string): URL da aÃ§Ã£o
- action (string): Tipo (edit, delete, view, add, export, download)
- label (string): Texto do botÃ£o (opcional, auto se nÃ£o passar)
- classe (string): Classes Tailwind adicionais (opcional)
- confirm (boolean): Pede confirmaÃ§Ã£o antes (padrÃ£o: false para delete)
- data (array): Atributos data-* customizados (opcional)

Exemplos:
```html
<!-- Editar -->
<x-action-button :href="route('patrimonios.edit', $patrimonio)" action="edit" />

<!-- Deletar com confirmaÃ§Ã£o -->
<x-action-button :href="route('patrimonios.destroy', $patrimonio)" action="delete" method="POST" confirm="true" />

<!-- Exportar -->
<x-action-button :href="route('patrimonios.export')" action="export" label="Exportar RelatÃ³rio" />

<!-- Adicionar -->
<x-action-button :href="route('patrimonios.create')" action="add" label="Novo PatrimÃ´nio" />
```

7.2 STATUS-BADGE

Arquivo: status-badge.blade.php

Props:
- status (string): Status (Ativo, Inativo, Baixado, Pendente, Conferido, etc)
- size (string): Tamanho (xs, sm, md) - padrÃ£o: sm
- classe (string): Classes adicionais (opcional)

Cores AutomÃ¡ticas:
â”œâ”€ Ativo â†’ green
â”œâ”€ Inativo â†’ gray
â”œâ”€ Baixado â†’ red
â”œâ”€ Pendente â†’ amber
â”œâ”€ Conferido â†’ blue
â””â”€ (extendÃ­vel)

Exemplos:
```html
<x-status-badge status="Ativo" />
<x-status-badge status="Baixado" size="lg" />
<x-status-badge :status="$patrimonio->SITUACAO" />
```

7.3 TABLE-HEADER

Arquivo: table-header.blade.php

Props:
- label (string): Texto da coluna
- sortable (boolean): Permite sort (padrÃ£o: true)
- sortField (string): Campo no BD para ordenar (ex: NUPATRIMONIO)
- currentSort (string): Campo atualmente ordenado
- currentDirection (string): asc ou desc

Exemplo:
```html
<table>
    <thead>
        <tr>
            <th>
                <x-table-header label="PatrimÃ´nio" sortField="NUPATRIMONIO" :currentSort="$sort" :currentDirection="$direction" />
            </th>
            <th>
                <x-table-header label="DescriÃ§Ã£o" sortField="DEPATRIMONIO" :currentSort="$sort" :currentDirection="$direction" />
            </th>
        </tr>
    </thead>
</table>
```

7.4 PATRIMONIO-FORM

Arquivo: patrimonio-form.blade.php (Componente grande para reutilizar em create/edit)

Props:
- patrimonio (Patrimonio|null): Objeto patrimÃ´nio (null para create)
- action (string): create ou edit
- mÃ©todo (string): POST ou PATCH

Gerencia:
- Campos de entrada (NUPATRIMONIO, DEPATRIMONIO, CODOBJETO, etc)
- ValidaÃ§Ã£o no frontend (Alpine.js)
- Modal de confirmaÃ§Ã£o de mudanÃ§as
- Logs de campo alterado

Exemplo em create.blade.php:
```html
<x-patrimonio-form :patrimonio="null" action="create" />
```

Exemplo em edit.blade.php:
```html
<x-patrimonio-form :patrimonio="$patrimonio" action="edit" />
```

================================================================================
8. FLUXOS DE NEGÃ“CIO PRINCIPAIS
================================================================================

8.1 CRIAR NOVO PATRIMÃ”NIO

Ator: Consultor ou Admin
Objetivo: Registrar novo bem no sistema

Passos:
1. Acessar /patrimonios/create
2. Preencher formulÃ¡rio (NUPATRIMONIO, DEPATRIMONIO, CODOBJETO, CDPROJETO, etc)
3. Clicar "Salvar"
4. ValidaÃ§Ãµes no lado do cliente (Alpine.js)
5. POST /patrimonios com dados
6. ValidaÃ§Ãµes no servidor (StorePatrimonioRequest)
7. PatrimonioService::criar() executado
   a. DB::beginTransaction()
   b. Patrimonio::create($dados)
   c. MovPartr::create(['acao' => 'CRIACAO'])
   d. Notificar funcionÃ¡rio (se atribuÃ­do)
   e. Log info âœ…
   f. DB::commit()
8. Redirect para show com mensagem "PatrimÃ´nio criado com sucesso!"
9. Tabela movpartr registra a aÃ§Ã£o

Dados Salvos:
- patr: novo registro NUSEQPATR gerado
- movpartr: nova entrada com acao=CRIACAO
- auditoria: log de quem criou, quando

PossÃ­veis Erros:
- NUPATRIMONIO duplicado â†’ Erro 422
- CODOBJETO invÃ¡lido â†’ Erro 422
- Sem permissÃ£o â†’ Erro 403

8.2 EDITAR PATRIMÃ”NIO

Ator: Consultor ou Admin
Objetivo: Atualizar informaÃ§Ãµes de bem existente

Passos:
1. Acessar /patrimonios/{id}/edit
2. FormulÃ¡rio preenchido com dados atuais
3. Alterar campos desejados
4. Sistema detecta mudanÃ§as (JavaScript comparar objeto original)
5. Clicar "Salvar"
6. Modal mostra: "VocÃª alterou: [DEPATRIMONIO, CDLOCAL]" com antes e depois
7. Confirmar
8. PATCH /patrimonios/{id} com dados
9. PatrimonioService::atualizar() executado
   a. DB::beginTransaction()
   b. Carregar Patrimonio::find($id)
   c. Registrar valores antigos em auditoria
   d. $patrimonio->update($dados)
   e. MovPartr::create(['acao' => 'ATUALIZACAO', 'de' => ..., 'para' => ...])
   f. Log info âœ…
   g. DB::commit()
10. Redirect para show com "PatrimÃ´nio atualizado!"
11. HistÃ³rico (movpartr) exibe todas as alteraÃ§Ãµes

Dados Salvos:
- patr: registro NUSEQPATR atualizado
- movpartr: nova entrada com acao=ATUALIZACAO
- auditoria: log completo de mudanÃ§as

PossÃ­veis Erros:
- CDLOCAL invÃ¡lido â†’ Erro 422
- Conflito (outro usuÃ¡rio editou) â†’ Aviso

8.3 DELETAR PATRIMÃ”NIO

Ator: Consultor ou Admin
Objetivo: Remover bem do sistema

Passos:
1. Acessar /patrimonios/{id}
2. Clicar botÃ£o "Deletar"
3. Modal pede confirmaÃ§Ã£o: "Tem certeza? Isto nÃ£o pode ser desfeito."
4. Confirmar
5. DELETE /patrimonios/{id}
6. PatrimonioService::deletar() executado
   a. DB::beginTransaction()
   b. Registrar backup em MovPartr com acao=DELECAO + JSON do patrimÃ´nio
   c. Patrimonio::destroy($id)
   d. Log warn âš ï¸ com dados deletados
   e. DB::commit()
7. Redirect para /patrimonios com "PatrimÃ´nio deletado!"
8. Arquivo de backup criado em storage/backups/patrimonio_<id>_<timestamp>.json

Dados Afetados:
- patr: registro NUSEQPATR deletado
- movpartr: registro com backup (JSON)
- backups: arquivo JSON com cÃ³pia completa

PossÃ­veis Erros:
- PatrimÃ´nio nÃ£o existe â†’ Erro 404
- Sem permissÃ£o â†’ Erro 403

8.4 LISTAR PATRIMÃ”NIOS COM FILTROS

Ator: Qualquer usuÃ¡rio autenticado
Objetivo: Buscar patrimÃ´nios com filtros

Passos:
1. Acessar GET /patrimonios (sem params)
   - Retorna Ãºltimos 50 por DTOPERACAO DESC
2. Preencher filtros (Projeto, Local, FuncionÃ¡rio, SituaÃ§Ã£o, Data AquisiÃ§Ã£o)
3. Cada mudanÃ§a de filtro dispara busca por AJAX
4. JavaScript usa SearchFilter.js para debounce (500ms)
5. GET /patrimonios?projeto=8&local=001&funcionario=123&situacao=Ativo
6. PatrimonioController::index() executa
   a. Construir Eloquent query com joins
   b. Aplicar where's de cada filtro
   c. Order by DTOPERACAO desc
   d. Paginar (50 por pÃ¡gina)
   e. Retornar JSON ou HTML (depends on Accept header)
7. Tabela atualiza com resultados
8. Total de registros exibido no topo

Performance:
- Ãndices em (CDPROJETO, CDLOCAL), CDMATRFUNCIONARIO, SITUACAO
- Cache de projetos/locais (30min)
- PaginaÃ§Ã£o (mÃ¡x 50 registros por request)

8.5 IMPORTAR PATRIMÃ”NIOS EM LOTE

Ator: Consultor
Objetivo: Carregar mÃºltiplos patrimÃ´nios via arquivo TXT/CSV

Passos:
1. Acessar /patrimonios/import
2. Fazer upload de arquivo TXT (formato especÃ­fico)
3. Preview dos dados (primeiras 5 linhas)
4. Clicar "Confirmar ImportaÃ§Ã£o"
5. POST /patrimonios/import com arquivo
6. ImportacaoService::processar() executado
   a. Ler arquivo linha por linha
   b. Parsear cada linha (split por tab ou vÃ­rgula)
   c. Validar cada registro
   d. DB::beginTransaction()
   e. Para cada linha vÃ¡lida:
      - Patrimonio::firstOrCreate(['NUPATRIMONIO' => ...])
      - MovPartr::create(['acao' => 'IMPORT'])
   f. Para cada erro, registrar em log
   g. DB::commit()
   h. Gerar relatÃ³rio: "Importados: 150, Erros: 5"
   i. Log info âœ…
7. Arquivo backup criado em storage/backups/import_<timestamp>.json
8. RelatÃ³rio exibido com opÃ§Ã£o de baixar erros

Dados Processados:
- patr: mÃºltiplos inserts ou updates
- movpartr: entrada para cada importaÃ§Ã£o
- logs: arquivo de erros em storage/logs/

PossÃ­veis Erros:
- Formato invÃ¡lido â†’ Skip linha
- CODOBJETO nÃ£o existe â†’ Skip linha + log erro
- Arquivo vazio â†’ Erro

================================================================================
9. INTEGRAÃ‡ÃƒO COM KINGHOST
================================================================================

SERVIDOR: KingHost (SSH: plansul@ftp.plansul.info)
APP REMOTE: ~/www/estoque-laravel
PHP VERSION: php82 (OBRIGATÃ“RIO, nÃ£o usar php padrÃ£o)
DATABASE: mysql07-farm10.kinghost.net:3306

9.1 CREDENCIAIS E ACESSO

Arquivo: .env (NÃƒO commitar, valores locais)

Local (.env):
DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=plansul
DB_USERNAME=root
DB_PASSWORD=

KingHost (.env):
DB_HOST_KINGHOST=mysql07-farm10.kinghost.net
DB_USERNAME_KINGHOST=plansul004_add2
DB_PASSWORD_KINGHOST=A33673170a
DB_DATABASE_KINGHOST=plansul04

SSH:
KINGHOST_USER=plansul
KINGHOST_HOST=ftp.plansul.info
KINGHOST_KEY=/path/to/private_key (se usar SSH key)

9.2 FLUXO DE SINCRONIZAÃ‡ÃƒO

Banco Local â† Banco KingHost (unidirecional)

Procedimento:
1. Conectar via SSH ao KingHost
2. Executar query no BD remoto
3. Receber resultado em TSV (tab-separated values)
4. Parse no Laravel (explode("\t"))
5. Upsert em banco local (INSERT ... ON DUPLICATE UPDATE)
6. Log de quantidades sincronizadas
7. Auditoria em database.log

Script One-off: scripts/kinghost_sync_master.php

Uso:
```bash
php artisan tinker
> include_once('scripts/kinghost_sync_master.php');
> syncPatrimonios(); // Sincroniza patr
> syncLocais();      // Sincroniza locais_projeto
```

Ou via SSH direto:
```bash
ssh plansul@ftp.plansul.info "cd ~/www/estoque-laravel && php82 artisan sync:kinghost --table=patr"
```

9.3 CAMPOS SINCRONIZADOS

Tabelas CrÃ­ticas:
â”œâ”€ patr (patrimÃ´nios)
â”œâ”€ locais_projeto
â”œâ”€ tabfant (projetos)
â”œâ”€ objetopatr (tipos)
â”œâ”€ funcionarios
â”œâ”€ tipopatr
â””â”€ movpartr

Mapeamento de Colunas KingHost â†’ Local:
```
KingHost.patr.NUSEQPATR â†’ Local.patr.NUSEQPATR
KingHost.patr.NUPATRIMONIO â†’ Local.patr.NUPATRIMONIO
... (1:1 naming)
```

9.4 BACKUPS E RECUPERAÃ‡ÃƒO

Backup AutomÃ¡tico Antes de Sync:
```php
$backup = DB::table('patr')->get();
Storage::put("backups/pre_sync_patr_" . now()->format('Y-m-d_Hms') . ".json", 
            json_encode($backup));
```

Restaurar Backup:
```bash
php artisan restore:backup --file=pre_sync_patr_2025-01-15_140530.json
```

9.5 TROUBLESHOOTING KingHost

Erro: "Parse error: unexpected ':'"
SoluÃ§Ã£o: Usar `php82` em vez de `php`

Erro: "root composer.json requires php ^8.2"
SoluÃ§Ã£o: `php82 ~/composer.phar install`

Erro: "Connection refused" ao conectar BD
SoluÃ§Ã£o: Verificar DNS, checar se acesso SSH estÃ¡ ativo

Erro: "untracked files would be overwritten by merge"
SoluÃ§Ã£o: `git stash` antes de `git pull`

================================================================================
10. SCRIPTS E UTILITÃRIOS
================================================================================

LOCALIZAÃ‡ÃƒO: scripts/ (diretÃ³rio, nÃ£o parte do deploy permanente)

CLASSIFICAÃ‡ÃƒO:

One-off (Executar uma vez):
â”œâ”€ kinghost_sync_master.php - SincronizaÃ§Ã£o completa
â”œâ”€ criar_backup.ps1 - Backup antes de operaÃ§Ã£o
â”œâ”€ buscar_locais_por_projeto.php - DiagnÃ³stico
â””â”€ verificar_datas_aquisicao.php - Auditoria

ReutilizÃ¡vel (Permanente):
â”œâ”€ scripts/analisar_estrutura_uf.php - AnÃ¡lise de UFs
â””â”€ start_laravel_server.ps1 - Iniciar dev server

10.1 PROCEDIMENTO ONE-OFF

Quando criar:
1. Adicionar comentÃ¡rio na primeira linha: // one-off
2. Descrever objetivo e parÃ¢metros
3. Avisar no chat: "Vou executar script one-off: <nome> que <objetivo>"
4. Executar com --dry-run se possÃ­vel
5. Gerar LOG em storage/logs/
6. Documentar resultado
7. DELETAR arquivo do repositÃ³rio

Exemplo:
```php
// one-off: Sincronizar patrimÃ´nios do KingHost para local
// Objetivo: Restaurar dados apÃ³s perda
// Uso: php artisan tinker > include_once('scripts/sync_patrimonio.php');

$count = 0;
try {
    // SSH query ...
    // Process ...
    Log::info("âœ… [sync_patrimonio] Sincronizados $count registros");
    echo "Sucesso! $count patrimÃ´nios sincronizados\n";
} catch (Exception $e) {
    Log::error("âŒ [sync_patrimonio] Erro: " . $e->getMessage());
    echo "Erro: " . $e->getMessage() . "\n";
}
```

10.2 SCRIPTS PERMANENTES

Documentar em `.txt` dentro de scripts/README_SCRIPTS.txt:

```
SCRIPTS REUTILIZÃVEIS
=====================

start_laravel_server.ps1
- Objetivo: Iniciar servidor de desenvolvimento
- Uso: .\scripts\start_laravel_server.ps1
- Output: Servidor rodando em http://localhost:8000

criar_backup.ps1
- Objetivo: Backup full antes de operaÃ§Ã£o crÃ­tica
- Uso: .\scripts\criar_backup.ps1
- Output: ZIP em archive/backups/pre_action_<timestamp>.zip
```

================================================================================
11. SEGURANÃ‡A E PERMISSÃ•ES
================================================================================

11.1 AUTENTICAÃ‡ÃƒO

MÃ©todo: Laravel Auth + Sanctum (tokens)

Fluxo:
1. UsuÃ¡rio faz login em /login
2. Credenciais validadas contra tabela users
3. Session criada (cookie)
4. Redirect para /patrimonios ou dashboard

Guard PadrÃ£o: web (session-based)
Guard API: sanctum (token-based, se usar API)

11.2 AUTORIZAÃ‡ÃƒO

MÃ©todo: Policies + Permissions (Laravel Policies)

Estrutura:
- Policy (app/Policies/PatrimonioPolicy.php) define "view", "create", "update", "delete"
- Middleware CheckPermission valida antes de controller

Exemplo de Policy:
```php
class PatrimonioPolicy
{
    public function view(User $user, Patrimonio $patrimonio): bool {
        // Apenas proprietÃ¡rio ou admin pode ver
        return $user->id === $patrimonio->user_id || $user->is_admin;
    }

    public function create(User $user): bool {
        return $user->hasRole('consultor') || $user->hasRole('admin');
    }
}
```

Uso em Controller:
```php
$this->authorize('view', $patrimonio);
```

Ou em Blade:
```blade
@can('edit', $patrimonio)
    <x-action-button :href="route('patrimonios.edit', $patrimonio)" action="edit" />
@endcan
```

11.3 PROTEÃ‡ÃƒO CSRF

AutomÃ¡tica em Laravel:
- Form inclui @csrf (token)
- Middleware VerifyCsrfToken valida

Todas as views Blade devem incluir:
```blade
<form method="POST" action="/patrimonios">
    @csrf
    <!-- campos -->
</form>
```

11.4 VALIDAÃ‡ÃƒO DE ENTRADA

ObrigatÃ³rio em FormRequests:

```php
public function rules(): array {
    return [
        'NUPATRIMONIO' => 'required|string|max:20|unique:patr',
        'DEPATRIMONIO' => 'required|string|max:300',
        'CODOBJETO' => 'required|integer|exists:objetopatr,NUSEQOBJ',
    ];
}
```

NUNCA confiar em dados do cliente.
SEMPRE validar no servidor.

11.5 PROTEÃ‡ÃƒO DE DADOS

Passwords:
- Hash com bcrypt (Laravel padrÃ£o)
- NUNCA armazenar em plain text

Dados SensÃ­veis:
- Usar .env para credenciais
- .env nunca commitar
- HTTPS em produÃ§Ã£o (KingHost = HTTPS automÃ¡tico)

Backup:
- Senhas nÃ£o incluÃ­das em backups (removidas antes)
- Backups armazenados seguro (archive/backups/)

11.6 LOGGING E AUDITORIA

Toda aÃ§Ã£o crÃ­tica deve ser logada:
- CriaÃ§Ã£o de patrimÃ´nio
- EdiÃ§Ã£o de patrimÃ´nio
- DeleÃ§Ã£o
- Login/Logout
- Acesso a relatÃ³rios
- ExportaÃ§Ãµes

Formato:
```
[2025-02-02 14:30:45] INFO âœ… [PatrimonioService] patrimÃ´nio criado
    usuario: consultor@plansul.com
    nuseqpatr: 12345
    acao: CRIACAO
```

RetenÃ§Ã£o: Logs rodam por 30 dias (configure em config/logging.php)

================================================================================
12. CHECKLIST DE DESENVOLVIMENTO
================================================================================

ANTES DE INICIAR QUALQUER TAREFA:

Leitura:
[ ] Li este documento completo
[ ] Li .github/copilot-instructions.md
[ ] Entendi a arquitetura (fluxo Controllers â†’ Services â†’ Models)
[ ] Identifiquei componentes/mÃ³dulos relacionados

PreparaÃ§Ã£o:
[ ] Git branch criado (git checkout -b feature/nome)
[ ] Backup criado (scripts/criar_backup.ps1)
[ ] Banco local atualizado (php artisan migrate)
[ ] npm run dev ou npm run build executado

DURANTE IMPLEMENTAÃ‡ÃƒO:

CÃ³digo:
[ ] SeparaÃ§Ã£o de responsabilidades respeitada
[ ] Componentes Blade reutilizados (se houver)
[ ] MÃ³dulos JS modularizados
[ ] Logs com emojis padronizados
[ ] Tratamento de erros completo (try-catch)
[ ] ValidaÃ§Ã£o no servidor (FormRequest)
[ ] PHPDoc adicionado em classes/mÃ©todos

Estilo:
[ ] Sem CSS customizado (APENAS Tailwind)
[ ] TODOS os estilos tÃªm dark: correspondente
[ ] Responsivo testado (mobile, tablet, desktop)
[ ] Tema claro E escuro testados
[ ] Nenhuma classe inventada

Testes Locais:
[ ] Funcionalidade testada em navegador
[ ] Console sem erros (F12)
[ ] Network sem 404s ou 500s
[ ] ValidaÃ§Ã£o do formulÃ¡rio funciona
[ ] Pagination funciona
[ ] Filtros funcionam
[ ] EdiÃ§Ã£o registra auditoria
[ ] Dark mode comutÃ¡vel

ANTES DE COMMITAR:

ValidaÃ§Ã£o:
[ ] php -l app/**/*.php (sem erros de sintaxe)
[ ] npm run build (sem erros de build)
[ ] Database migrations up-to-date
[ ] Logs limpos de erros crÃ­ticos

Git:
[ ] git status (verificar arquivos nÃ£o esperados)
[ ] NÃ£o incluir: vendor/, node_modules/, .env
[ ] Incluir: migrations, models, views, componentes
[ ] git add . (ou git add <arquivos>)
[ ] git commit -m "DescriÃ§Ã£o clara da mudanÃ§a"

Exemplo de commit:
```
âœ… Feature: Adicionar campo CODIGO_BARRAS em patrimÃ´nios
- Nova migration para expandir coluna
- Componente form atualizado
- Dark mode suportado
- Logs implementados
```

ANTES DE PUSH (se tiver permissÃ£o):

[ ] git log --oneline -5 (verificar histÃ³rico)
[ ] git push origin feature/nome
[ ] Criar Pull Request no GitHub
[ ] Aguardar review

APÃ“S DEPLOY EM KINGHOST (quando aplicÃ¡vel):

SSH Verification:
```bash
ssh plansul@ftp.plansul.info
cd ~/www/estoque-laravel
php82 artisan migrate
php82 artisan cache:clear
php82 artisan view:clear
ls -la storage/logs/
tail -20 storage/logs/laravel.log
```

Testes ProduÃ§Ã£o:
[ ] Login funciona
[ ] Listar patrimÃ´nios funciona
[ ] Filtros funcionam
[ ] Criar patrimÃ´nio funciona
[ ] Editar patrimÃ´nio funciona
[ ] Deletar patrimÃ´nio funciona
[ ] Exportar relatÃ³rio funciona
[ ] Dark mode funciona
[ ] Mobile responsivo

================================================================================
APÃŠNDICE A: REFERÃŠNCIA RÃPIDA DE COMANDOS
================================================================================

Laravel/PHP:
php artisan serve                    # Inicia dev server (http://localhost:8000)
php artisan migrate                  # Aplica migrations
php artisan migrate:rollback         # Desfaz Ãºltima migration
php artisan db:seed                  # Roda seeders
php artisan tinker                   # REPL interativo
php artisan cache:clear              # Limpa cache
php artisan view:clear               # Limpa views compiladas
php artisan make:model Nome          # Cria novo model
php artisan make:controller NomeController    # Cria controller
php artisan make:command Nome        # Cria comando Artisan
php -l arquivo.php                   # Valida sintaxe PHP

NPM/Vite:
npm install                          # Instala dependÃªncias
npm run dev                          # Watch mode (Vite + Tailwind)
npm run build                        # Build produÃ§Ã£o
npm run lint                         # Lint JavaScript (se configurado)

Git:
git clone <repo>                     # Clona repositÃ³rio
git checkout -b feature/nome         # Cria branch
git add .                            # Stage files
git commit -m "msg"                  # Commit
git push origin branch               # Push (se tiver permissÃ£o)
git log --oneline                    # Ver histÃ³rico

SSH KingHost:
ssh plansul@ftp.plansul.info         # Conecta
cd ~/www/estoque-laravel             # Vai para app
php82 --version                      # Verifica PHP
php82 artisan command                # Roda artisan

MySQL:
mysql -h localhost -u root plansul   # Conecta BD local
SELECT * FROM patr LIMIT 5;          # Query exemplo
EXIT;                                # Sai do MySQL

================================================================================
APÃŠNDICE B: GLOSSÃRIO DE TERMOS TÃ‰CNICOS
================================================================================

API: Application Programming Interface - Interface para comunicaÃ§Ã£o entre sistemas
Artisan: CLI (Command Line Interface) do Laravel
Atomic Transaction: OperaÃ§Ã£o "tudo ou nada" no banco (BEGIN, COMMIT, ROLLBACK)
Audit Log: Registro de quem fez o quÃª e quando
Blade: Template engine do Laravel (views dinÃ¢micas em PHP)
Cache: Armazenamento rÃ¡pido em memÃ³ria ou arquivo
CSRF: Cross-Site Request Forgery - proteÃ§Ã£o contra requisiÃ§Ãµes nÃ£o autorizadas
Dark Mode: Tema escuro da interface
DRY: Don't Repeat Yourself - evitar duplicaÃ§Ã£o de cÃ³digo
Entity Relationship: Relacionamento entre tabelas (1:1, 1:N, M:N)
Eloquent: ORM (Object-Relational Mapping) do Laravel
FK (Foreign Key): Chave estrangeira (referÃªncia entre tabelas)
FormRequest: Classe Laravel que valida formulÃ¡rios
Guard: Sistema de autenticaÃ§Ã£o (web, api, etc)
Hash: Criptografia de password com bcrypt
Middleware: Filtro HTTP antes/depois de requisiÃ§Ã£o
Migration: Versionamento de schema do banco (up/down)
Model: Classe Eloquent que representa tabela do banco
Observable: PadrÃ£o de observer (events em modelos)
ORM: Object-Relational Mapping (Eloquent Ã© um ORM)
PHPDoc: DocumentaÃ§Ã£o em PHP (/** ... */)
PK (Primary Key): Chave primÃ¡ria (identificador Ãºnico)
Policy: Classe que autoriza aÃ§Ãµes em modelos (Laravel)
Refactoring: Melhorar cÃ³digo sem mudar funcionalidade
Repository Pattern: AbstraÃ§Ã£o de acesso a dados
Route: Mapeamento de URL para Controller
Seed: Dados iniciais no banco (fixtures)
Service Layer: Classe que encapsula lÃ³gica de negÃ³cio
Transaction: Grupo de operaÃ§Ãµes de banco (atÃ´micas)
Utility-first CSS: Tailwind - classes pequenas que combinam (nÃ£o componentes)
Vite: Bundler moderno e rÃ¡pido para assets (CSS, JS)
Webpacking: Bundling de assets (Vite = ferramenta moderna)

================================================================================
APÃŠNDICE C: ESTRUTURA DE DIRETÃ“RIOS COMPLETA
================================================================================

plansul/
â”œâ”€ .env (NÃƒO COMMITAR - local)
â”œâ”€ .env.example (template)
â”œâ”€ .gitignore
â”œâ”€ .github/
â”‚  â””â”€ copilot-instructions.md (InstruÃ§Ãµes para Copilot - LEIA)
â”œâ”€ app/
â”‚  â”œâ”€ Console/Commands/ (Comandos artisan)
â”‚  â”œâ”€ Http/
â”‚  â”‚  â”œâ”€ Controllers/ (Rotas â†’ LÃ³gica HTTP)
â”‚  â”‚  â”œâ”€ Middleware/ (Filtros HTTP)
â”‚  â”‚  â””â”€ Requests/ (ValidaÃ§Ã£o de formulÃ¡rio)
â”‚  â”œâ”€ Models/ (Eloquent ORM)
â”‚  â”œâ”€ Services/ (LÃ³gica de negÃ³cio)
â”‚  â”œâ”€ Observers/ (Event listeners)
â”‚  â”œâ”€ Policies/ (AutorizaÃ§Ã£o granular)
â”‚  â”œâ”€ Helpers/ (FunÃ§Ãµes auxiliares)
â”‚  â””â”€ Providers/ (Service providers)
â”œâ”€ archive/backups/ (Backups histÃ³ricos)
â”œâ”€ bootstrap/
â”‚  â”œâ”€ app.php (InicializaÃ§Ã£o do framework)
â”‚  â””â”€ cache/ (ConfiguraÃ§Ã£o compilada)
â”œâ”€ config/ (ConfiguraÃ§Ãµes da app)
â”œâ”€ database/
â”‚  â”œâ”€ migrations/ (Versionamento de schema)
â”‚  â”œâ”€ seeders/ (Dados iniciais)
â”‚  â””â”€ imports/ (Arquivos TXT/JSON para seed)
â”œâ”€ docs/ (DocumentaÃ§Ã£o estÃ¡tica)
â”œâ”€ lang/
â”‚  â””â”€ pt-br/ (TraduÃ§Ãµes portuguÃªs)
â”œâ”€ Massa/ (Dados para testes)
â”œâ”€ public/ (Arquivos pÃºblicos - index.php, css, js compilados)
â”‚  â”œâ”€ build/ (Vite output - NOT EDIT)
â”‚  â”œâ”€ img/ (Imagens estÃ¡ticas)
â”‚  â””â”€ js/ (MÃ³dulos JavaScript e compilados)
â”œâ”€ resources/
â”‚  â”œâ”€ views/
â”‚  â”‚  â”œâ”€ components/ (Componentes Blade reutilizÃ¡veis)
â”‚  â”‚  â”œâ”€ layouts/ (Layout base)
â”‚  â”‚  â”œâ”€ patrimonios/ (Views de patrimÃ´nios)
â”‚  â”‚  â””â”€ ... (outros mÃ³dulos)
â”‚  â”œâ”€ css/ (CSS fonte)
â”‚  â”œâ”€ js/ (JavaScript fonte)
â”‚  â””â”€ sass/ (SCSS source)
â”œâ”€ routes/ (Mapeamento de URLs)
â”‚  â”œâ”€ web.php (Rotas web)
â”‚  â””â”€ auth.php (AutenticaÃ§Ã£o)
â”œâ”€ scripts/ (One-offs e utilitÃ¡rios, NÃƒO permitem no deploy)
â”œâ”€ storage/
â”‚  â”œâ”€ logs/ (Logs da aplicaÃ§Ã£o)
â”‚  â”œâ”€ backups/ (Backups de dados)
â”‚  â””â”€ app/ (Dados processados)
â”œâ”€ tests/ (Testes automatizados, se houver)
â”œâ”€ vendor/ (DependÃªncias Composer - NÃƒO COMMITAR)
â”œâ”€ artisan (CLI Laravel)
â”œâ”€ composer.json (DependÃªncias PHP)
â”œâ”€ composer.lock (Lock file - COMMITAR)
â”œâ”€ package.json (DependÃªncias NPM)
â”œâ”€ package-lock.json (Lock file - COMMITAR)
â”œâ”€ vite.config.js (ConfiguraÃ§Ã£o do bundler)
â”œâ”€ tailwind.config.js (ConfiguraÃ§Ã£o Tailwind)
â”œâ”€ phpstan.neon (AnÃ¡lise estÃ¡tica PHP)
â””â”€ DOCUMENTACAO_COMPLETA_SISTEMA.txt (Este arquivo - referÃªncia 100%)

================================================================================
APÃŠNDICE D: TEMPLATE PARA NOVA FEATURE
================================================================================

Quando adicionar nova feature ao sistema:

1. MIGRATION (database/migrations/YYYY_MM_DD_*.php)
```php
Schema::table('patr', function (Blueprint $table) {
    $table->string('NOVO_CAMPO', 100)->nullable()->comment('DescriÃ§Ã£o');
    $table->index('NOVO_CAMPO');
});
```

2. MODEL (app/Models/Patrimonio.php)
```php
protected $fillable = [
    // ... existing
    'NOVO_CAMPO',
];

protected $casts = [
    // ... existing
    'NOVO_CAMPO' => 'string',
];
```

3. FORM COMPONENT (resources/views/components/patrimonio-form.blade.php)
```blade
<div class="md:col-span-2">
    <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">
        Label Novo Campo
    </label>
    <input x-model="formData.NOVO_CAMPO" type="text" 
        class="block w-full h-8 text-xs border-gray-300 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-300 rounded-md shadow-sm focus:ring-2 focus:ring-indigo-500" />
</div>
```

4. SHOW VIEW (resources/views/patrimonios/show.blade.php)
```blade
<div>
    <x-input-label value="Novo Campo" />
    <input type="text" value="{{ $patrimonio->NOVO_CAMPO ?? '-' }}" readonly 
        class="mt-1 block w-full bg-gray-100 dark:bg-gray-700" />
</div>
```

5. EDIT VIEW (resources/views/patrimonios/edit.blade.php)
```blade
// Adicionar ao labelCampos JS
'NOVO_CAMPO': 'Novo Campo',
```

6. VALIDATION (app/Http/Requests/StorePatrimonioRequest.php)
```php
'NOVO_CAMPO' => 'nullable|string|max:100',
```

7. SERVICE (app/Services/PatrimonioService.php)
```php
Log::info('âœ… [PatrimonioService] patrimÃ´nio atualizado', [
    'NOVO_CAMPO' => $patrimonio->NOVO_CAMPO,
]);
```

8. TEST CHECKLIST
[ ] Migration roda (php artisan migrate)
[ ] FormulÃ¡rio aceita valor
[ ] Valor salva no banco
[ ] Valor exibido no show
[ ] Edit mostra mudanÃ§a no modal
[ ] Dark mode sem problemas
[ ] Mobile responsivo

================================================================================
FIM DA DOCUMENTAÃ‡ÃƒO COMPLETA
================================================================================

VersÃ£o: 2.0
Data: 2 de fevereiro de 2026
PrÃ³xima revisÃ£o: 2026-04-02

Para atualizar este documento, solicite modificaÃ§Ãµes via chat.
Qualquer dÃºvida, consulte .github/copilot-instructions.md ou este arquivo.

================================================================================
